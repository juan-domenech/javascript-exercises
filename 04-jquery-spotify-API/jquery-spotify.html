<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Spotify API jQuery sandbox</title>
    <script src="https://code.jquery.com/jquery-2.2.0.js"></script>
</head>
<body>

    <h1 id='top-h1'>Spotify API jQuery sandbox</h1>

    <form>
        <input>
        <button>search your favourite artist!</button>
    </form>

    <h2 id='top-h2'></h2>

    <select id='artist-list'>
    </select>

    <h3 id='top-h3'></h3>

    <ul id='response-list'></ul>

    <select id='album-list'>
    </select>

    <h4 id='top-h4'></h4>

    <select id='track-list'>
    </select>

    <h5 id='top-h5'></h5>

<script>

//Challenge. Spotify API
//Create an app that:
//Allow us to search for an artist
//It should show a list of artists found
//When clicking an album it should show a list of albums
//When clicking an album it should show a list of tracks
//When clicking a track it should reproduce a preview of the song (30'')
//Hints:
//https://developer.spotify.com/web-api/search-item/
//https://developer.spotify.com/web-api/console/get-search-item/?q=tania+bowra&type=artist#complete
//https://api.spotify.com

var spotifyURL = 'https://api.spotify.com/v1/'

    // Hide unnecessary fields
    $('#top-h2').hide('')
    $('#top-h3').hide('')
    $('#top-h4').hide('')
    $('#top-h5').hide('')
    $('ul').hide('')
    $('select').hide('')
    $('iframe').html('<iframe src=""></iframe>')
    $('iframe').hide('')


// Search button
$("button").on("click", function(e) {

    e.preventDefault();

    var $myInput = $("input");
    var requestedArtist = $myInput.val();

    $.ajax({
        url: spotifyURL+'search?q='+requestedArtist+'&type=artist',
        dataType: "json",
        success: function( response ) {

            if ( response.artists.items.length == 0 ){
                console.log('Sorry. No artist found');
                $('#top-h2').html('Sorry no artists found :( Please try again.')
                $('#top-h2').show()

                // Hide unnecessary fields
                $('#top-h3').hide('')
                $('#top-h4').hide('')
                $('#top-h5').hide('')
                $('select').hide('')
                $('iframe').html('<iframe src=""></iframe>')
                $('iframe').hide('')

            }else if( response.artists.items.length > 1 ){

                $('#top-h2').html('Multiple artists found ('+response.artists.items.length+'). <br> Please select one from the list:')
                $('#top-h2').show()

                // Hide unnecessary fields
                $('#top-h3').hide('')
                $('#top-h4').hide('')
                $('#top-h5').hide('')
                $('#album-list').hide()
                $('#track-list').hide()
                $('iframe').html('<iframe src=""></iframe>')
                $('iframe').hide('')

                var numResponses = response.artists.items.length;
                var listResponses ='';
                for (var i=0; i<numResponses; i++) {
                    listResponses += "<option value='"+response.artists.items[i].id+"'>" + response.artists.items[i].name +"</option>"
                }
                $("#artist-list").html(listResponses)
                $("#artist-list").show()


            }else{

                $('#top-h2').html('One (1) artist found: '+response.artists.items[0].name)
                $('#top-h2').show()

                $("#artist-list").html('<option>'+response.artists.items[0].name+'</option>')
                $('#artist-list').show

                // Hide unnecessary fields
                $('#top-h3').hide('')
                $('#top-h4').hide('')
                $('#top-h5').hide('')
                $('#album-list').hide()
                $('#track-list').hide()
                $('iframe').html('<iframe src=""></iframe>')
                $('iframe').hide('')


                $.ajax({
                    url: spotifyURL+'artists/'+response.artists.items[0].id+'/albums',
                    dataType: "json",
                    success: function( response ) {

                        $('#top-h3').html('Albums: ('+response.items.length+')')
                        $('#top-h3').show()

                        var numResponses = response.items.length;
                        var listResponses ='';
                        for (var i=0; i<numResponses; i++) {
                        listResponses += "<option value='"+response.items[i].id+"'>"+response.items[i].name+"</option>"
                        }
                        $("#album-list").html(listResponses)
                        $('#album-list').show()


                    }

                });

            }

        }

    })

});


// Artist list selected
$( "#artist-list" ).change(function(e) {

    var artistID = this.value;

    //$('#top-h2').html('Artist ID '+this.value)

    // Hide unnecessary fields
    $('#top-h4').hide()
    $('#top-h5').hide('')
    $('#track-list').hide()
    $('iframe').html('<iframe src=""></iframe>')
    $('iframe').hide('')

    $.ajax({
        url: spotifyURL+'artists/'+artistID+'/albums',
        dataType: "json",
        success: function( response ) {

            $('#top-h3').html('Albums: ('+response.items.length+')')
            $('#top-h3').show()

            var numResponses = response.items.length;
            var listResponses ='';
            for (var i=0; i<numResponses; i++) {
                listResponses += "<option value='"+response.items[i].id+"'>"+response.items[i].name+"</option>"
            }
            $("#album-list").html(listResponses)
            $('#album-list').show()

        }
    });
});


// Album list selected
$( "#album-list" ).change(function(e) {

    var albumID = this.value;

    // Hide unnecessary fields
    $('#top-h5').hide('')
    $('iframe').html('<iframe src=""></iframe>')
    $('iframe').hide('')


    $.ajax({
        url: spotifyURL+'albums/'+albumID+'/tracks',
        dataType: "json",
        success: function( response ) {

            $('#top-h4').html('Tracks: ('+response.items.length+')')
            $('#top-h4').show()

            var numResponses = response.items.length;
            var listResponses ='';
            for (var i=0; i<numResponses; i++) {
                listResponses += "<option value='"+response.items[i].id+"'>"+response.items[i].name+"</option>"
            }
            $("#track-list").html(listResponses)
            $('#track-list').show()

            //$('#top-h4').append("<img src='"+response.album.images[1].url+"'</a>")

        }
    });

});


// Track list selected
$( "#track-list" ).change(function(e) {

    var trackID = this.value;

    $.ajax({
        url: spotifyURL+'tracks/'+trackID,
        dataType: "json",
        success: function( response ) {

            //$('#top-h5').html('Name: '+response.name)
            $('#top-h5').html('Playing...')
            $('#top-h5').show()

            //$('#top-h5').append("<iframe href='"+response.preview_url+"'><br><br>Click here to play a free 30 Seconds demo!</a></iframe>")
            console.log("response.preview_url:",response.preview_url)

            $('#top-h5').append("<br><iframe src='"+response.preview_url+"' width='300' height='80'></iframe>")
            $('iframe').show()

        }
    });
});


</script>

</body>
</html>