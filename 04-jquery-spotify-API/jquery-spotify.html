<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    -->
    <script src="https://code.jquery.com/jquery-2.2.0.js"></script>
</head>
<body>

    <h1 id='top-h1'>Spotify API jQuery sandbox</h1>

    <form>
        <input>
        <button>search your favourite artist!</button>
    </form>

    <h2 id='top-h2'></h2>

    <select id='artist-list'>
    </select>

    <h3 id='top-h3'></h3>

    <ul id='response-list'></ul>

    <select id='album-list'>
    </select>

    <h4 id='top-h4'></h4>

    <select id='track-list'>
    </select>

<script>

//Challenge. Spotify API
//Create an app that:
//Allow us to search for an artist
//It should show a list of artists found
//When clicking an album it should show a list of albums
//When clicking an album it should show a list of tracks
//When clicking a track it should reproduce a preview of the song (30'')
//Hints:
//https://developer.spotify.com/web-api/search-item/
//https://developer.spotify.com/web-api/console/get-search-item/?q=tania+bowra&type=artist#complete
//https://api.spotify.com

var spotifyURL = 'https://api.spotify.com/v1/'

// Search button
$("button").on("click", function(e) {

    e.preventDefault();

    var $myInput = $("input");
    var requestedArtist = $myInput.val();

    $.ajax({
        url: spotifyURL+'search?q='+requestedArtist+'&type=artist',
        dataType: "json",
        success: function( response ) {
            //console.log ( "$.ajax minimal : %o", response.responseData.results );

            $('#top-h2').html('')
            $('#top-h3').html('')
            $('#top-h4').html('')
            $('ul').html('')
            $('select').html('')

            if ( response.artists.items.length == 0 ){
                console.log('Sorry. No artist found');
                $('#top-h2').html('Sorry no artists found :( Please try again.')
                $('#top-h3').html('')
                $('#top-h4').html('')
                $('select').html('')

            }else if( response.artists.items.length > 1 ){
                console.log('Multiple artists found. Rendering them all!')
                $('#top-h2').html('Multiple artists found ('+response.artists.items.length+'). Please select one from the list:')

                var numResponses = response.artists.items.length;
                var listResponses ='';
                for (var i=0; i<numResponses; i++) {
                    listResponses += "<option value='"+response.artists.items[i].id+"'>" + response.artists.items[i].name +"</option>"
                }
                $("#artist-list").html(listResponses)
                $('#top-h3').html('')
                $('#top-h4').html('')



            }else{
                //console.log('Exact match');
                $('#top-h2').html('One (1) artist found: '+response.artists.items[0].name)

                $("#artist-list").html('<option>'+response.artists.items[0].name+'</option>')

                $.ajax({
                    url: spotifyURL+'artists/'+response.artists.items[0].id+'/albums',
                    dataType: "json",
                    success: function( response ) {

                        $('#top-h3').html('Albums: ('+response.items.length+')')

                        var numResponses = response.items.length;
                        var listResponses ='';
                        for (var i=0; i<numResponses; i++) {
                        listResponses += "<option value='"+response.items[i].id+"'>"+response.items[i].name+"</option>"
                        }
                        $("#album-list").html(listResponses)



                    }
                });



            }

        }

    })

});


// Artist list selected
$( "#artist-list" ).change(function(e) {

    var artistID = this.value;

                //$('#top-h2').html('Artist ID '+this.value)

                $.ajax({
                    url: spotifyURL+'artists/'+artistID+'/albums',
                    dataType: "json",
                    success: function( response ) {

                        $('#top-h3').html('Albums: ('+response.items.length+')')

                        var numResponses = response.items.length;
                        var listResponses ='';
                        for (var i=0; i<numResponses; i++) {
                        listResponses += "<option value='"+response.items[i].id+"'>"+response.items[i].name+"</option>"
                        }
                        $("#album-list").html(listResponses)

                    }
                });
});


// Album list selected
$( "#album-list" ).change(function(e) {

    var albumID = this.value;
    //console.log(albumID)

                $('#top-h4').html('Album ID '+this.value)

                $.ajax({
                    url: spotifyURL+'albums/'+albumID+'/tracks',
                    dataType: "json",
                    success: function( response ) {

                        $('#top-h4').html('Tracks: ('+response.items.length+')')

                        var numResponses = response.items.length;
                        var listResponses ='';
                        for (var i=0; i<numResponses; i++) {
                        listResponses += "<option value='"+response.items[i].id+"'>"+response.items[i].name+"</option>"
                        }
                        $("#track-list").html(listResponses)

                    }
                });


});


</script>

</body>
</html>